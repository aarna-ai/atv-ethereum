<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\AlgoContract.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> AlgoContract.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/23</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/7</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/26</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// // SPDX-License-Identifier: Unlicensed
&nbsp;
pragma solidity =0.8.0;
&nbsp;
import "./interface/IAFi.sol";
import "./interface/IAFiStorage.sol";
import "@openzeppelin/contracts/utils/math/SafeMath.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "./libraries/ArrayUtils.sol";
&nbsp;
/**
 * @title AFiManager.
 * @notice Manager conntract for handling rebalancing and adding/updating team wallets in the AFi contracts.
 * @dev Error codes: AFM01: Caller is not MultiSig. AFM02: Cannot be address zero. AFM03: Teamwallet already present. AFM04: Previous and current active status cannot be the same.
 */
contract AlgoAFiManager is Ownable {
  // using SafeERC20 for IERC20;
  using SafeMath for uint;
  using ArrayUtils for uint[];
  using ArrayUtils for address[];
&nbsp;
  address[] private _uTokens;
  address public multisig;
  IAFiStorage internal aFiStorage;
&nbsp;
<span class="fstat-no" title="function not covered" >  constructor(address _multisig) {</span>
<span class="cstat-no" title="statement not covered" >    require(_multisig != address(0), "AFM02")</span>;
<span class="cstat-no" title="statement not covered" >    multisig = _multisig</span>;
  }
&nbsp;
  /**
   * @notice Modifier that ensures functions implementing it can only be invoked by the MultiSig contract
   */
<span class="fstat-no" title="function not covered" >  modifier onlyMultiSig() {</span>
<span class="cstat-no" title="statement not covered" >    require(msg.sender == multisig, "AFM01")</span>;
    _;
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function updateMultisig(address _multisig) external onlyMultiSig {</span>
<span class="cstat-no" title="statement not covered" >    require(_multisig != address(0), "AFM02")</span>;
<span class="cstat-no" title="statement not covered" >    multisig = _multisig</span>;
  }
&nbsp;
  /**
   * @notice To rebalance the underlying tokens.
   * @dev Remove all DepositToken from multiple underlying tokens &amp; Invest into new underlying tokens.
   * @param aFiContract Address of AFi contract (AToken).
   * @param _aFiStorage Address of AFiStorage contract.
   * @param newUToken Address of the new underlying tokens.
   */
<span class="fstat-no" title="function not covered" >  function rebalanceUnderlyingTokens(</span>
    bytes memory data, // Underlying token proportion should be zero
    IAFi aFiContract,
    IAFiStorage _aFiStorage,
    address[] memory newUToken,
    address[] memory uTokenToRemove
  ) external onlyMultiSig {
<span class="cstat-no" title="statement not covered" >    bool isActiveRebalEnabled = _aFiStorage.isAFiActiveRebalanced(address(aFiContract));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    validateNewUTokenData(data, newUToken)</span>;
<span class="cstat-no" title="statement not covered" >    aFiContract.updatePoolData(data)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    _uTokens = aFiContract.getUTokens()</span>;
&nbsp;
    {
<span class="cstat-no" title="statement not covered" >        for(uint i = 0; i &lt; _uTokens.length - 1; i++){</span>
<span class="cstat-no" title="statement not covered" >            for(uint j = 0; j &lt; uTokenToRemove.length - 1; j++){</span>
<span class="cstat-no" title="statement not covered" >                if(_uTokens[i] == uTokenToRemove[j] &amp;&amp; isActiveRebalEnabled){</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                    aFiContract.withdrawRebalanceAmount(_uTokens[i])</span>;
                
<span class="cstat-no" title="statement not covered" >                    uint rebalanceAmount = IERC20(_uTokens[i]).balanceOf(address(aFiContract));</span>
                    // To avoid stack too deep error
                    
                    // Get Deposit token back from the UToken that is going to be rebalanced
<span class="cstat-no" title="statement not covered" >                    aFiManagerSwap(</span>
                        _uTokens[i],
                        uTokenToRemove[j],
                        rebalanceAmount,
                        aFiContract
                    );
&nbsp;
                        // To avoid stack too deep error
<span class="cstat-no" title="statement not covered" >                    (uint uTokenToRemoveIndex, ) = _uTokens.indexOf(_uTokens[i]);</span>
<span class="cstat-no" title="statement not covered" >                    aFiContract.removeIndex(uTokenToRemoveIndex)</span>;
                }
            }
        }
        
<span class="cstat-no" title="statement not covered" >        IAFi(aFiContract).updateProportion()</span>;
    }
}
  /**
   * @notice Gateway for initiating a Swap from the AFiManager contract.
   * @dev The contract must not be paused. It can only be invoked by the AFiManager contract.
   * @param from The source token which is swapped for the destination token.
   * @param to The destination token to which the from token is swapped into.
   * @param amount Amount of from token for swapping.
   */
<span class="fstat-no" title="function not covered" >  function aFiManagerSwap(</span>
    address from,
    address to,
    uint amount,
    IAFi aFiContract
  ) internal {
    {
      // Initiate Swap via OneInchExchange
<span class="cstat-no" title="statement not covered" >      aFiContract.swapViAFiManager(IERC20(from), IERC20(to), amount)</span>;
    }
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function validateNewUTokenData(bytes memory _data, address[] memory newUToken) internal pure {</span>
<span class="cstat-no" title="statement not covered" >    IAFi.PoolsData memory pooldata = abi.decode(_data, (IAFi.PoolsData));</span>
<span class="cstat-no" title="statement not covered" >    require(</span>
      pooldata._underlyingTokens.length ==
        pooldata._underlyingTokensProportion.length &amp;&amp;
        pooldata._priceOracles.length == pooldata._compound.length &amp;&amp;
        pooldata._compound.length == pooldata._dToken.length,
      "Array lengths"
    );
<span class="cstat-no" title="statement not covered" >    require(pooldata._underlyingTokens.length &lt;= 10, "One UToken data should be passed")</span>;
    // require(
    //   pooldata._underlyingTokensProportion[0] == 0,
    //   "NewUtoken Proportion must be zero"
    // );
   
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function encodePoolData(IAFi.PoolsData memory pooldata)</span>
    public
    pure
    returns (bytes memory)
  {
<span class="cstat-no" title="statement not covered" >    return (abi.encode(pooldata));</span>
  }
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Feb 28 2023 16:48:02 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
